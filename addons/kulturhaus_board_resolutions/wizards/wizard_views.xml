<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Create Resolution Wizard Form View -->
    <record id="view_create_resolution_wizard_form" model="ir.ui.view">
        <field name="name">create.resolution.wizard.form</field>
        <field name="model">create.resolution.wizard</field>
        <field name="arch" type="xml">
            <form string="Create Board Resolution">
                
                <!-- Step 1: Basic Information -->
                <div invisible="[('step', '!=', 'basic')]">
                    <h2>Step 1: Basic Information</h2>
                    <group>
                        <group>
                            <field name="title" required="1"/>
                            <field name="date" required="1"/>
                        </group>
                        <group>
                            <field name="project_id"/>
                            <field name="task_id" domain="[('project_id', '=', project_id)]"/>
                        </group>
                    </group>
                    <group>
                        <field name="description" placeholder="Brief description of what this resolution is about..."/>
                    </group>
                </div>

                <!-- Step 2: Attendance -->
                <div invisible="[('step', '!=', 'attendance')]">
                    <h2>Step 2: Board Member Attendance</h2>
                    <div class="alert alert-info" role="alert">
                        <strong>Quorum Check:</strong> At least <field name="total_board_members" readonly="1" class="font-weight-bold"/> board members are registered. 
                        You need more than half present to meet quorum.
                    </div>
                    
                    <group>
                        <group>
                            <field name="total_board_members" readonly="1"/>
                            <field name="present_count" readonly="1"/>
                        </group>
                        <group>
                            <field name="quorum_met" widget="boolean_toggle" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="Present Members">
                        <field name="present_members" widget="many2many_checkboxes" nolabel="1"/>
                    </group>
                    
                    <div class="alert alert-warning" role="alert" invisible="[('quorum_met', '=', True)]">
                        <i class="fa fa-warning"/> <strong>Quorum not met!</strong> You must select more than half of the board members to proceed.
                    </div>
                </div>

                <!-- Step 3: Resolution Text -->
                <div invisible="[('step', '!=', 'resolution')]">
                    <h2>Step 3: Resolution Text</h2>
                    <div class="alert alert-info" role="alert">
                        Enter the detailed text of the resolution. This will be the official text that appears in the final document.
                    </div>
                    <field name="resolution_text" placeholder="BESCHLUSS: Der Vorstand beschlieÃŸt..." required="1"/>
                </div>

                <!-- Step 4: Voting -->
                <div invisible="[('step', '!=', 'voting')]">
                    <h2>Step 4: Voting</h2>
                    
                    <group>
                        <group>
                            <field name="voting_mode" widget="radio"/>
                        </group>
                        <group>
                            <field name="total_votes" readonly="1"/>
                            <field name="result" widget="badge" decoration-success="result=='passed'" decoration-danger="result=='rejected'" decoration-warning="result=='tie'" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- Secret Voting -->
                    <group string="Vote Counts" invisible="[('voting_mode', '!=', 'secret')]">
                        <group>
                            <field name="votes_for"/>
                            <field name="votes_against"/>
                            <field name="votes_abstain"/>
                        </group>
                    </group>
                    
                    <!-- Open Voting -->
                    <div invisible="[('voting_mode', '!=', 'open')]">
                        <group string="Votes For">
                            <field name="votes_for_members" widget="many2many_checkboxes" domain="[('id', 'in', present_members)]" nolabel="1"/>
                        </group>
                        <group string="Votes Against">
                            <field name="votes_against_members" widget="many2many_checkboxes" domain="[('id', 'in', present_members)]" nolabel="1"/>
                        </group>
                        <group string="Abstentions">
                            <field name="votes_abstain_members" widget="many2many_checkboxes" domain="[('id', 'in', present_members)]" nolabel="1"/>
                        </group>
                    </div>
                    
                    <div class="alert alert-warning" role="alert" invisible="['|', ('voting_mode', '!=', 'secret'), ('total_votes', '=', present_count)]">
                        <i class="fa fa-warning"/> Total votes (<field name="total_votes" readonly="1"/>) must equal present members (<field name="present_count" readonly="1"/>).
                    </div>
                </div>

                <!-- Step 5: Confirmation -->
                <div invisible="[('step', '!=', 'confirmation')]">
                    <h2>Step 5: Confirmation</h2>
                    <div class="alert alert-success" role="alert">
                        <i class="fa fa-check-circle"/> Ready to create resolution!
                    </div>
                    
                    <group>
                        <group>
                            <label for="title" string="Title"/>
                            <div><field name="title" readonly="1" nolabel="1"/></div>
                            <label for="date" string="Date"/>
                            <div><field name="date" readonly="1" nolabel="1"/></div>
                            <label for="project_id" string="Project" invisible="[('project_id', '=', False)]"/>
                            <div invisible="[('project_id', '=', False)]"><field name="project_id" readonly="1" nolabel="1"/></div>
                        </group>
                        <group>
                            <label for="present_count" string="Present Members"/>
                            <div><field name="present_count" readonly="1" nolabel="1"/> of <field name="total_board_members" readonly="1" nolabel="1"/></div>
                            <label for="voting_mode" string="Voting Mode"/>
                            <div><field name="voting_mode" readonly="1" nolabel="1"/></div>
                            <label for="result" string="Result"/>
                            <div><field name="result" widget="badge" readonly="1" nolabel="1"/></div>
                        </group>
                    </group>
                </div>

                <!-- Hidden fields -->
                <field name="step" invisible="1"/>
                <field name="board_members" invisible="1"/>

                <footer>
                    <button string="Previous" name="action_previous_step" type="object" class="btn-secondary" invisible="[('step', '=', 'basic')]"/>
                    <button string="Next" name="action_next_step" type="object" class="btn-primary" invisible="[('step', '=', 'confirmation')]"/>
                    <button string="Create Resolution" name="action_create_resolution" type="object" class="btn-primary" invisible="[('step', '!=', 'confirmation')]"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Wizard Action -->
    <record id="action_create_resolution_wizard" model="ir.actions.act_window">
        <field name="name">Create Board Resolution</field>
        <field name="res_model">create.resolution.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_create_resolution_wizard_form"/>
    </record>

</odoo>